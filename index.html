<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>CSS Парсер</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
  <style>
    :root {
      --mylogo: #26D9CD;
      --accent: #26D97C;
      --myinterface: #16847D;
      --bg: #121212;
      --black2: #191919;
      --black3: #1C1C1C;
      --grey: #404040;
      --grey2: #666666;
      --text: #FFFFFF;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', Arial, sans-serif;
      font-weight: 300;
      max-width: 100%
    }
    h1 {
      font-family: 'Ubuntu', Arial, sans-serif;
      font-weight: 300;
      margin-bottom: 12px;
      margin-top: 20px;
      font-size: 48px;
      text-align: center;
      -webkit-text-size-adjust: 100%;
    }
    input, button {
      width: 100%;
      padding: 20px;
      margin-bottom: 10px;
      border: none;
      border-radius: 24px;
      font-size: 16px;
      font-family: 'DM Sans', Arial, sans-serif;
      font-weight: 300;
    }
    input {
      background: var(--black3);
      color: var(--text);
      width: 600px;
      display: block;
      margin: 0 auto;
    }
    input, button {
      box-sizing: border-box; 
      display: block; 
    }
    button {
      width: auto;
      padding: 16px 32px;
      border-radius: 60px;
      background: var(--bg);
      color: var(--text);
      cursor: pointer;
      border: 1px solid var(--accent);
      transition: all 0.4s ease;
      font-size: 16px;
      font-family: 'DM Sans', Arial, sans-serif;
      font-weight: 300;
      display: block;
      margin: 0 auto;
      margin-top: 40px;
    }
    button:hover {
      border: 1px solid var(--accent);
      background: var(--bg);
      color: var(--accent);
    }
    button:active {
      border: 1px solid var(--myinterface);
      background: var(--bg); 
      color: var(--myinterface);                
      transform: scale(0.96);  
    }
    #result {
      background: var(--bg);
      color: var(--text);
      padding: 12px;
      margin-top: 10px;
      font-size: 16px;
      font-family: 'DM Sans', Arial, sans-serif;
      font-weight: 300;
      min-height: 40px;
      word-break: break-all;
    }
    pre {
      background: var(--bg);
      color: var(--text);
      border-radius: 4px;
      padding: 10px;
      margin: 0;
      font-size: 0.95em;
      overflow-x: auto;
    }
    .error {
      color: var(--accent);
    }
  </style>
</head>
<body>
  <h1>CSS Парсер стиля</h1>
  <input type="text" id="urlInput" placeholder="Введите URL сайта, например https://example.com">
  <button onclick="parseCss()">Получить CSS</button>
  <div id="result"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    async function parseCss() {
      const url = document.getElementById('urlInput').value.trim();
      if (!url) {
        return document.getElementById('result').innerHTML = '<p class="error">Введите URL сайта</p>';
      }
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p>Загрузка...</p>';
      try {
        const response = await fetch('https://style-parser.vercel.app/api/parse', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });
        const data = await response.json();
        if (!response.ok) {
          if (response.status === 404) {
            throw new Error('API не найден (404). Проверьте деплой на Vercel и передеплойте проект.');
          } else if (response.status === 500) {
            throw new Error('Ошибка на сервере (500). Попробуйте позже или проверьте логи Vercel.');
          } else if (response.status === 400) {
            throw new Error(data.error || 'Неверный запрос (400). Убедитесь, что URL корректный.');
          } else {
            throw new Error(data.error || `Ошибка сервера (${response.status})`);
          }
        }
        const code = document.createElement('pre');
        const codeBlock = document.createElement('code');
        codeBlock.className = 'css';
        const cmsInfo = data.cms ? `CMS: ${data.cms}\n` : 'CMS: Неизвестно\n';
        let techInfo = '';
        if (data.techStack) {
          const languages = data.techStack.languages ? data.techStack.languages.join(', ') : 'Неизвестно';
          const frontend = data.techStack.frontendFrameworks ? data.techStack.frontendFrameworks.join(', ') : 'Vanilla JS';
          const cssFw = data.techStack.cssFrameworks ? data.techStack.cssFrameworks.join(', ') : 'Custom CSS';
          const jsLib = data.techStack.jsLibraries ? data.techStack.jsLibraries.join(', ') : 'Неизвестно';
          const backend = data.techStack.backendHints ? data.techStack.backendHints.join(', ') : 'Неизвестно';
          techInfo = `Стек: Языки - ${languages}; Frontend - ${frontend}; CSS фреймворки - ${cssFw}; JS библиотеки - ${jsLib}; Backend - ${backend}\n`;
        }
        codeBlock.textContent = cmsInfo + techInfo + (data.css || 'CSS не найден');
        code.appendChild(codeBlock);
        resultDiv.innerHTML = '';
        resultDiv.appendChild(code);
        hljs.highlightElement(codeBlock);
      } catch (e) {
        console.error('Детали ошибки:', e); // Для отладки в консоли
        resultDiv.innerHTML = `<p class="error">Ошибка: ${e.message}</p><p class="error">Проверьте консоль (F12) для деталей. Если 404 - передеплойте API на Vercel.</p>`;
      }
    }
  </script>
</body>
</html>